<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A4I Content Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: 'Inter', Arial, sans-serif; background: #f5f8fc; margin: 0; }
    .header-bar {
      display: flex;
      align-items: center;
      gap: 18px;
      background: #23354c;
      padding: 0 20px;
      height: 64px;
      color: #fff;
      box-shadow: 0 2px 10px #0001;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-bar button {
      background: none; border: none; color: #fff; font-size: 1.08em;
      font-weight: 600; padding: 7px 22px; cursor: pointer; border-radius: 8px;
      transition: background 0.15s;
    }
    .header-bar button.active, .header-bar button:hover { background: #00408033; }
    .main-content { max-width: 900px; margin: 36px auto 0 auto; padding: 32px 18px 60px 18px; background: #fff; border-radius: 16px; box-shadow: 0 2px 24px #00224414; min-height: 480px; }
    .editor-icon {
      font-size: 5rem; color: #00408088; margin-bottom: 18px;
      text-align: center;
    }
    .editor-welcome {
      text-align: center;
      margin-top: 45px;
    }
    .editor-welcome .editor-message {
      font-size: 1.45rem;
      font-weight: 700;
      color: #274468;
      margin-top: 18px;
    }
    .blog-edit-block {
      background: #f7fafc; border-radius: 12px; box-shadow: 0 1px 4px #00306611;
      padding: 22px; margin-bottom: 28px; position: relative;
      border: 1.5px solid #dde6f0;
      display: flex;
    }
    .blog-icon-cell {
      min-width: 36px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding-top: 9px;
      padding-right: 8px;
    }
    .blog-fields-cell {
      flex: 1;
      padding-left: 8px;
    }
    label {
      display: block;
      font-weight: 500;
      color: #223c60;
      padding-left: 14px;
      margin-bottom: 3px;
      margin-top: 13px;
    }
    .blog-fields-cell label:first-child { margin-top: 0; }
    input, textarea {
      width: 97%; font-size: 1.08em; border-radius: 5px;
      border: 1.2px solid #c3d1ea; padding: 9px 12px; background: #fff;
      transition: border 0.15s;
      margin-bottom: 14px;
      margin-top: 7px;
      margin-left: 14px;
    }
    input:focus, textarea:focus { border-color: #004080; outline: none; }
    textarea { resize: vertical; min-height: 95px; max-height: 250px; }
    .actions { margin-top: 12px; margin-left: 14px; }
    .actions button { margin-right: 10px; padding: 7px 18px; border: none; border-radius: 7px; cursor: pointer; background: #eee; color: #c33; font-weight: 600; }
    .add-btn { background: #229; color: #fff; margin-top: 20px; }
    .generate-btn, .export-btn {
      background: #004080; color: #fff; margin-left: 18px; margin-top: 20px;
      border: none; border-radius: 7px; padding: 9px 24px; font-size: 1.06em; font-weight: 600;
      cursor: pointer;
    }
    .generate-btn { background: #2866c0; }
    .export-btn { background: #17a96f; }
    .title-icon {
      font-size: 1.7em; color: #2387c8; display: block; margin-bottom: 3px;
    }
    .image-insert-row {
      display: flex; align-items: center; gap: 10px; margin-bottom: 15px; margin-left: 14px;
    }
    .image-insert-row label {
      margin: 0; padding: 0 5px 0 0; font-weight: 400; color: #18416b; min-width: 220px;
    }
    .image-insert-row input {
      width: 400px; min-width: 200px; max-width: 420px;
      font-size: 1em; margin-left: 0; margin-bottom: 0;
    }
    .image-insert-row .image-preview {
      max-height: 56px; max-width: 100px; border-radius: 4px; box-shadow: 0 1px 6px #00224422;
      margin-left: 12px;
    }
    #loading { color: #333; margin: 24px 0; font-size: 1.1em; }
    #error { color: #c00; margin: 24px 0; }
    @media (max-width: 600px) {
      .main-content { padding: 10px; }
      .header-bar { flex-wrap: wrap; gap: 4px; }
      .blog-edit-block { padding: 10px; flex-direction: column; }
      .blog-fields-cell, .image-insert-row { padding-left: 0; margin-left: 0; }
      .image-insert-row input { width: 92vw; }
    }
  </style>
</head>
<body>
  <div class="header-bar">
    <span style="font-size:2.1em; margin-right:12px;">&#9998;</span>
    <button id="edit-blog-btn" class="active" onclick="showSection('blog')">Edit Blog</button>
    <button onclick="showSection('research')">Edit Research</button>
    <button onclick="showSection('ms-team')">Edit MS Team</button>
    <button onclick="showSection('iiitb-team')">Edit IIITB Team</button>
    <button onclick="showSection('events')">Edit Events & News</button>
  </div>
  <div class="main-content" id="main-content"></div>

  <script>
    let blogs = [];
    let fullBlogHTML = ""; // Will store the fetched blogs.html file
    let currentSection = "welcome";

    function escapeHTML(str) {
      return String(str ?? "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function showWelcome() {
      document.querySelectorAll('.header-bar button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('edit-blog-btn').classList.remove('active');
      currentSection = "welcome";
      document.getElementById('main-content').innerHTML = `
        <div class="editor-welcome">
          <div class="editor-icon">&#128736;</div>
          <div class="editor-message">We will help you edit the A4I Pages</div>
        </div>
      `;
    }

    function showSection(section) {
      document.querySelectorAll('.header-bar button').forEach(btn => btn.classList.remove('active'));
      switch(section) {
        case 'blog':
          document.getElementById('edit-blog-btn').classList.add('active');
          fetchAndParseBlogs();
          break;
        default:
          showWelcome();
      }
    }

    async function fetchAndParseBlogs() {
      const main = document.getElementById('main-content');
      main.innerHTML = '<div id="loading">Loading blogs from blogs.html...</div>';
      try {
        const res = await fetch('blogs.html');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const html = await res.text();
        fullBlogHTML = html;
        const doc = new DOMParser().parseFromString(html, "text/html");
        const ul = doc.querySelector("ul.blog-list");
        if (!ul) throw new Error("Blog list not found in blogs.html");
        blogs = [];
        for (const li of ul.querySelectorAll("li")) {
          const mainDiv = li.querySelector('div');
          const spans = mainDiv.querySelectorAll('span');
          let title = spans.length > 1 ? spans[1].textContent.trim() : "";
          let author = "", date = "";
          let authorDateText = mainDiv.childNodes;
          let afterTitle = false;
          for (let n of authorDateText) {
            if (n === spans[1]) {
              afterTitle = true;
              continue;
            }
            if (afterTitle && n.nodeType === 3 && n.textContent.includes(',')) {
              let pieces = n.textContent.split(',').map(s => s.trim()).filter(Boolean);
              author = pieces[0] || "";
              date = pieces[1] || "";
              break;
            }
          }
          const profile = li.querySelector('.profile-detail');
          let paras = profile ? Array.from(profile.querySelectorAll('p')).map(p=>p.textContent.trim()) : [];
          let images = [];
          if (profile) {
            let nodes = Array.from(profile.childNodes);
            let pi = 0;
            for (let node of nodes) {
              if (node.nodeName === "P") {
                let nextIdx = nodes.indexOf(node) + 1;
                let next = nodes[nextIdx];
                if (next && next.nodeName === "IMG") {
                  images.push(next.getAttribute('src'));
                } else {
                  images.push("");
                }
                pi++;
              }
            }
          }
          while (images.length < 2) images.push("");
          blogs.push({
            title, author, date,
            para1: paras[0] || "",
            para2: paras[1] || "",
            img1: images[0] || "",
            img2: images[1] || ""
          });
        }
        showBlogEditor();
      } catch (err) {
        main.innerHTML = `<div id="error">Error: ${err.message}</div>`;
      }
    }

    function showBlogEditor() {
      currentSection = "blog";
      let html = `<h2 style="color:#004080;display:flex;align-items:center;gap:12px;margin-bottom:28px;">
        <span class="title-icon">&#9998;</span> Blog Editor
      </h2>
      <button class="add-btn" onclick="addBlog()">+ Add New Blog</button>
      <button class="generate-btn" onclick="exportHTML()">Generate HTML fragment</button>
      <button class="export-btn" onclick="exportFullHTML()">Export full file</button>
      <textarea id="export-area" style="margin-top:22px;display:none;width:100%;" rows="10"></textarea>
      <div id="blog-editor"></div>`;
      document.getElementById('main-content').innerHTML = html;
      renderEditor();
    }

    function renderEditor() {
      const container = document.getElementById('blog-editor');
      if (!container) return;
      container.innerHTML = '';
      blogs.forEach((blog, idx) => {
        const blogBlock = document.createElement('div');
        blogBlock.className = 'blog-edit-block';
        blogBlock.innerHTML = `
          <div class="blog-icon-cell">
            <span class="title-icon">&#128221;</span>
          </div>
          <div class="blog-fields-cell">
            <label>Blog Title:
              <input type="text" placeholder="Blog Title" value="${escapeHTML(blog.title)}" onchange="updateBlog(${idx}, 'title', this.value)" />
            </label>
            <label>Author:
              <input type="text" value="${escapeHTML(blog.author)}" onchange="updateBlog(${idx}, 'author', this.value)" />
            </label>
            <label>Date:
              <input type="text" value="${escapeHTML(blog.date)}" onchange="updateBlog(${idx}, 'date', this.value)" />
            </label>
            <label>Paragraph 1:
              <textarea onchange="updateBlog(${idx}, 'para1', this.value)">${escapeHTML(blog.para1)}</textarea>
            </label>
            <div class="image-insert-row">
              <label>Insert image after Para 1 (if required):</label>
              <input type="text" placeholder="./Images/abc.png" value="${escapeHTML(blog.img1)}" onchange="updateBlog(${idx}, 'img1', this.value)" />
              ${blog.img1 ? `<img src="${escapeHTML(blog.img1)}" class="image-preview" onerror="this.style.display='none'">` : ''}
            </div>
            <label>Paragraph 2:
              <textarea onchange="updateBlog(${idx}, 'para2', this.value)">${escapeHTML(blog.para2)}</textarea>
            </label>
            <div class="image-insert-row">
              <label>Insert image after Para 2 (if required):</label>
              <input type="text" placeholder="./Images/abc.png" value="${escapeHTML(blog.img2)}" onchange="updateBlog(${idx}, 'img2', this.value)" />
              ${blog.img2 ? `<img src="${escapeHTML(blog.img2)}" class="image-preview" onerror="this.style.display='none'">` : ''}
            </div>
            <div class="actions">
              <button onclick="deleteBlog(${idx})">Delete</button>
            </div>
          </div>
        `;
        container.appendChild(blogBlock);
      });
    }

    function updateBlog(idx, field, value) {
      blogs[idx][field] = value;
    }

    function deleteBlog(idx) {
      if (confirm('Are you sure you want to delete this blog?')) {
        blogs.splice(idx, 1);
        renderEditor();
      }
    }

    function addBlog() {
      blogs.unshift({ title: '', author: '', date: '', para1: '', para2: '', img1: '', img2: '' });
      renderEditor();
    }

    function exportHTML() {
      let html = `<ul class="blog-list" style="margin:0 0 16px 18px; padding-left:0; list-style-type: none;">\n`;
      blogs.forEach(blog => {
        html += `
  <li style="margin-bottom:11px;">
    <div style="display:flex; align-items:center;">
      <span style="font-size:1.18em; color:#ffaf19; margin-right:8px;">&#128161;</span>
      <span style="font-weight:600;">${escapeHTML(blog.title)}</span>, ${escapeHTML(blog.author)}, ${escapeHTML(blog.date)}
      <button class="info-btn" aria-label="Show blog content"
        style="margin-left:18px; background:none; border:none; font-size:1.23em; cursor:pointer; color:#4981a1;">&#9654;</button>
    </div>
    <div class="profile-detail" style="display:none; margin-top:10px; font-size:0.98rem; color:#212; background:#f7fafb; border-radius:8px; padding:16px 13px 12px 13px; text-align:left;">
      <p>${escapeHTML(blog.para1)}</p>
      ${blog.img1 ? `<img src="${escapeHTML(blog.img1)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
      <p>${escapeHTML(blog.para2)}</p>
      ${blog.img2 ? `<img src="${escapeHTML(blog.img2)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
    </div>
  </li>
        `.trim();
      });
      html += '\n</ul>';
      const exportArea = document.getElementById('export-area');
      exportArea.value = html;
      exportArea.style.display = 'block';
      exportArea.select();
    }

    // Export the entire HTML file, replacing just the blog-list
    function exportFullHTML() {
      let fragment = '';
      blogs.forEach(blog => {
        fragment += `
  <li style="margin-bottom:11px;">
    <div style="display:flex; align-items:center;">
      <span style="font-size:1.18em; color:#ffaf19; margin-right:8px;">&#128161;</span>
      <span style="font-weight:600;">${escapeHTML(blog.title)}</span>, ${escapeHTML(blog.author)}, ${escapeHTML(blog.date)}
      <button class="info-btn" aria-label="Show blog content"
        style="margin-left:18px; background:none; border:none; font-size:1.23em; cursor:pointer; color:#4981a1;">&#9654;</button>
    </div>
    <div class="profile-detail" style="display:none; margin-top:10px; font-size:0.98rem; color:#212; background:#f7fafb; border-radius:8px; padding:16px 13px 12px 13px; text-align:left;">
      <p>${escapeHTML(blog.para1)}</p>
      ${blog.img1 ? `<img src="${escapeHTML(blog.img1)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
      <p>${escapeHTML(blog.para2)}</p>
      ${blog.img2 ? `<img src="${escapeHTML(blog.img2)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
    </div>
  </li>
        `.trim();
      });
      let full = fullBlogHTML;
      // Replace the blog-list <ul>...</ul> in the file
      full = full.replace(/<ul class="blog-list"[^>]*>[\s\S]*?<\/ul>/, `<ul class="blog-list" style="margin:0 0 16px 18px; padding-left:0; list-style-type: none;">\n${fragment}\n</ul>`);
      const exportArea = document.getElementById('export-area');
      exportArea.value = full;
      exportArea.style.display = 'block';
      exportArea.select();
    }

    window.onload = function() {
      showWelcome();
      document.getElementById('edit-blog-btn').onclick = function() {
        document.querySelectorAll('.header-bar button').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        fetchAndParseBlogs();
      };
      document.querySelectorAll('.header-bar button:not(#edit-blog-btn)').forEach(btn => {
        btn.onclick = showWelcome;
      });
    };
  </script>
</body>
</html>
