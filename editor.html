<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A4I Content Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
body { font-family: 'Inter', Arial, sans-serif; background: #f5f8fc; margin: 0; }
.header-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  background: #23354c;
  padding: 0 10px;
  height: 58px;
  color: #fff;
  box-shadow: 0 2px 10px #0001;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-bar button {
  background: none; border: none; color: #fff; font-size: 1.06em;
  font-weight: 600; padding: 7px 15px; cursor: pointer; border-radius: 8px;
  transition: background 0.15s;
}
.header-bar button.active, .header-bar button:hover { background: #00408033; }
.main-content {
  max-width: 900px;
  margin: 32px auto 0 auto;
  padding: 26px 8px 40px 8px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 2px 18px #00224411;
  min-height: 440px;
}
.editor-icon {
  font-size: 5rem;
  color: #00408088;
  margin-bottom: 18px;
  text-align: center;
}
.editor-welcome {
  text-align: center;
  margin-top: 45px;
}
.editor-welcome .editor-message {
  font-size: 1.45rem;
  font-weight: 700;
  color: #274468;
  margin-top: 18px;
}
.blog-edit-block {
  background: #f7fafc;
  border-radius: 12px;
  box-shadow: 0 1px 4px #00306611;
  padding: 18px 9px 14px 9px;
  margin-bottom: 20px;
  position: relative;
  border: 1.2px solid #dde6f0;
  display: flex;
}
.blog-icon-cell {
  min-width: 36px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  padding-top: 9px;
  padding-right: 8px;
}
.blog-fields-cell {
  flex: 1;
  padding-left: 8px;
}
label {
  display: block;
  font-weight: 500;
  color: #223c60;
  padding-left: 14px;
  margin-bottom: 3px;
  margin-top: 13px;
}
.blog-fields-cell label:first-child { margin-top: 0; }
input, textarea {
  width: 97%;
  font-size: 1.04em;
  border-radius: 5px;
  border: 1.1px solid #c3d1ea;
  padding: 8px 10px;
  background: #fff;
  transition: border 0.15s;
  margin-bottom: 12px;
  margin-top: 7px;
  margin-left: 14px;
}
input:focus, textarea:focus { border-color: #004080; outline: none; }
textarea { resize: vertical; min-height: 80px; max-height: 200px; }
.actions { margin-top: 9px; margin-left: 14px; }
.actions button {
  margin-right: 10px;
  padding: 6px 16px;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  background: #eee;
  color: #c33;
  font-weight: 600;
}
.title-icon {
  font-size: 1.4em;
  color: #2387c8;
  display: block;
  margin-bottom: 2px;
}
.image-insert-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 11px;
  margin-left: 14px;
}
.image-insert-row label {
  margin: 0;
  padding: 0 5px 0 0;
  font-weight: 400;
  color: #18416b;
  min-width: 135px;
  font-size: 0.98em;
}
.image-insert-row input {
  width: 200px;
  min-width: 80px;
  max-width: 250px;
  font-size: 0.97em;
  margin-left: 0;
  margin-bottom: 0;
}
.image-insert-row .image-preview {
  max-height: 46px;
  max-width: 70px;
  border-radius: 4px;
  box-shadow: 0 1px 6px #00224422;
  margin-left: 12px;
}
#loading { color: #333; margin: 24px 0; font-size: 1.1em; }
#error { color: #c00; margin: 24px 0; }
.action-btn-row {
  display: flex;
  flex-wrap: wrap;
  gap: 11px;
  margin-bottom: 15px;
}
.action-btn {
  font-size: 0.91em;
  padding: 9px 10px;
  min-width: 120px;
  border-radius: 7px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 1px 8px #00224415;
  text-align: center;
  margin-bottom: 0;
  color: #fff;
  transition: background 0.17s, transform 0.14s, opacity 0.13s;
  letter-spacing: 0.01em;
  outline: none;
}
.action-btn-primary {
  background: linear-gradient(90deg, #1947a3 0%, #196dc3 100%);
}
.action-btn-secondary {
  background: linear-gradient(90deg, #105c7d 0%, #159197 100%);
}
.action-btn-success {
  background: linear-gradient(90deg, #137d52 0%, #18c177 100%);
}
.action-btn:hover, .action-btn:focus {
  opacity: 0.93;
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 3px 14px #00224422;
}
@media (max-width: 700px) {
  .main-content { padding: 5px; }
  .header-bar { flex-wrap: wrap; gap: 4px; }
  .blog-edit-block { padding: 6px; flex-direction: column; }
  .blog-fields-cell, .image-insert-row { padding-left: 0; margin-left: 0; }
  .image-insert-row input { width: 88vw; }
  .action-btn-row { flex-direction: column; gap: 9px; }
  .action-btn { min-width: 60vw; font-size: 0.96em; }
}
  </style>
</head>
<body>
  <div class="header-bar">
    <span style="font-size:1.8em; margin-right:7px;">&#9998;</span>
    <button id="edit-blog-btn" class="active" onclick="showSection('blog')">Edit Blog</button>
    <button id="edit-ms-team-btn" onclick="showSection('ms-team')">Edit MS Team</button>
    <button id="edit-iiitb-team-btn" onclick="showSection('iiitb-team')">Edit IIITB Team</button>
    <button id="edit-events-btn" onclick="showSection('events')">Edit Events & News</button>
    <button id="edit-research-btn" onclick="showSection('research')">Edit Research</button>
  </div>
  <div class="main-content" id="main-content"></div>
  <script>
    // --- Utility ---
    function escapeHTML(str) {
    return String(str ?? "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // --- Globals ---
    let blogs = [], fullBlogHTML = "";
    let teamMembers = [], teamFileName = "", _fullTeamHTML = "";
    let eventsList = [], newsList = [], eventsNewsFile = "news-events.html", _fullEventsNewsHTML = "";
    let publicationsList = [], reportsList = [], researchFile = "research.html", _fullResearchHTML = "";

    // --- Welcome Page ---
    function showWelcome() {
    document.querySelectorAll('.header-bar button').forEach(btn => btn.classList.remove('active'));
    document.getElementById('edit-blog-btn').classList.remove('active');
    document.getElementById('main-content').innerHTML = `
        <div class="editor-welcome">
        <div class="editor-icon">&#128736;</div>
        <div class="editor-message">We will help you edit the A4I Pages</div>
        </div>
    `;
    }

    // --- Navigation (showSection) ---
    function showSection(section) {
    document.querySelectorAll('.header-bar button').forEach(btn => btn.classList.remove('active'));
    switch(section) {
        case 'blog':
        document.getElementById('edit-blog-btn').classList.add('active');
        showBlogEditorLoad();
        break;
        case 'ms-team':
        document.getElementById('edit-ms-team-btn').classList.add('active');
        showTeamEditorLoad('microsoft-team.html');
        break;
        case 'iiitb-team':
        document.getElementById('edit-iiitb-team-btn').classList.add('active');
        showTeamEditorLoad('iiitb-team.html');
        break;
        case 'events':
        document.getElementById('edit-events-btn').classList.add('active');
        showEventsNewsEditorLoad();
        break;
        case 'research':
        document.getElementById('edit-research-btn').classList.add('active');
        showResearchEditorLoad();
        break;
        default:
        showWelcome();
    }
    }
    // --- Blog Editor ---
    function showBlogEditorLoad() {
    document.getElementById('main-content').innerHTML = `
        <h2 style="color:#004080;display:flex;align-items:center;gap:12px;margin-bottom:28px;">
        <span class="title-icon">&#9998;</span> Blog Editor
        </h2>
        <button class="action-btn action-btn-secondary" onclick="fetchAndParseBlogs(true)">Load Blogs</button>
        <div id="blog-editor"></div>
    `;
    }
    async function fetchAndParseBlogs(renderNow) {
    const main = document.getElementById('blog-editor') || document.getElementById('main-content');
    main.innerHTML = '<div id="loading">Loading blogs from blogs.html...</div>';
    try {
        const res = await fetch('blogs.html');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const html = await res.text();
        fullBlogHTML = html;
        const doc = new DOMParser().parseFromString(html, "text/html");
        const ul = doc.querySelector("ul.blog-list");
        if (!ul) throw new Error("Blog list not found in blogs.html");
        blogs = [];
        for (const li of ul.querySelectorAll("li")) {
        const mainDiv = li.querySelector('div');
        const spans = mainDiv.querySelectorAll('span');
        let title = spans.length > 1 ? spans[1].textContent.trim() : "";
        let author = "", date = "";
        let authorDateText = mainDiv.childNodes;
        let afterTitle = false;
        for (let n of authorDateText) {
            if (n === spans[1]) {
            afterTitle = true;
            continue;
            }
            if (afterTitle && n.nodeType === 3 && n.textContent.includes(',')) {
            let pieces = n.textContent.split(',').map(s => s.trim()).filter(Boolean);
            author = pieces[0] || "";
            date = pieces[1] || "";
            break;
            }
        }
        const profile = li.querySelector('.profile-detail');
        let paras = profile ? Array.from(profile.querySelectorAll('p')).map(p=>p.textContent.trim()) : [];
        let images = [];
        if (profile) {
            let pNodes = Array.from(profile.querySelectorAll('p'));
            let allNodes = Array.from(profile.childNodes);
            pNodes.forEach(p => {
            let foundImg = "";
            let seenP = false;
            for (let node of allNodes) {
                if (node === p) {
                seenP = true;
                continue;
                }
                if (!seenP) continue;
                if (node.nodeType === 1 && node.nodeName === "IMG") {
                foundImg = node.getAttribute('src');
                break;
                }
                if (node.nodeType === 1 && node.nodeName === "P") break;
            }
            images.push(foundImg);
            });
        }
        while (images.length < 2) images.push("");
        blogs.push({
            title, author, date,
            para1: paras[0] || "",
            para2: paras[1] || "",
            img1: images[0] || "",
            img2: images[1] || ""
        });
        }
        if (renderNow) showBlogEditor();
    } catch (err) {
        main.innerHTML = `<div id="error">Error: ${err.message}</div>`;
    }
    }
    function showBlogEditor() {
    let html = `<div class="action-btn-row">
        <button class="action-btn action-btn-primary" onclick="addBlog()">+ Add New Blog</button>
        <button class="action-btn action-btn-secondary" onclick="exportHTML()">Generate file fragment - blog.html</button>
        <button class="action-btn action-btn-success" onclick="exportFullHTML()">Generate full file - blog.html</button>
    </div>
    <textarea id="export-area" style="margin-top:18px;display:none;width:100%;" rows="10"></textarea>
    <div id="blog-editor-list"></div>`;
    document.getElementById('blog-editor').innerHTML = html;
    renderEditor();
    }
    function renderEditor() {
    const container = document.getElementById('blog-editor-list');
    if (!container) return;
    container.innerHTML = '';
    blogs.forEach((blog, idx) => {
        const blogBlock = document.createElement('div');
        blogBlock.className = 'blog-edit-block';
        blogBlock.innerHTML = `
        <div class="blog-icon-cell">
            <span class="title-icon">&#128221;</span>
        </div>
        <div class="blog-fields-cell">
            <label>Blog Title:
            <input type="text" placeholder="Blog Title" value="${escapeHTML(blog.title)}" onchange="updateBlog(${idx}, 'title', this.value)" />
            </label>
            <label>Author:
            <input type="text" value="${escapeHTML(blog.author)}" onchange="updateBlog(${idx}, 'author', this.value)" />
            </label>
            <label>Date:
            <input type="text" value="${escapeHTML(blog.date)}" onchange="updateBlog(${idx}, 'date', this.value)" />
            </label>
            <label>Paragraph 1:
            <textarea onchange="updateBlog(${idx}, 'para1', this.value)">${escapeHTML(blog.para1)}</textarea>
            </label>
            <div class="image-insert-row">
            <label>Insert image after Para 1 (if required):</label>
            <input type="text" placeholder="./Images/abc.png" value="${escapeHTML(blog.img1)}" onchange="updateBlog(${idx}, 'img1', this.value)" />
            ${blog.img1 ? `<img src="${escapeHTML(blog.img1)}" class="image-preview" onerror="this.style.display='none'">` : ''}
            </div>
            <label>Paragraph 2:
            <textarea onchange="updateBlog(${idx}, 'para2', this.value)">${escapeHTML(blog.para2)}</textarea>
            </label>
            <div class="image-insert-row">
            <label>Insert image after Para 2 (if required):</label>
            <input type="text" placeholder="./Images/abc.png" value="${escapeHTML(blog.img2)}" onchange="updateBlog(${idx}, 'img2', this.value)" />
            ${blog.img2 ? `<img src="${escapeHTML(blog.img2)}" class="image-preview" onerror="this.style.display='none'">` : ''}
            </div>
            <div class="actions">
            <button onclick="deleteBlog(${idx})">Delete</button>
            </div>
        </div>
        `;
        container.appendChild(blogBlock);
    });
    }
    function updateBlog(idx, field, value) { blogs[idx][field] = value; }
    function deleteBlog(idx) {
    if (confirm('Are you sure you want to delete this blog?')) {
        blogs.splice(idx, 1); renderEditor();
    }
    }
    function addBlog() {
    blogs.unshift({ title: '', author: '', date: '', para1: '', para2: '', img1: '', img2: '' });
    renderEditor();
    }
    function exportHTML() {
    let html = `<ul class="blog-list" style="margin:0 0 16px 18px; padding-left:0; list-style-type: none;">\n`;
    blogs.forEach(blog => {
        html += `
    <li style="margin-bottom:11px;">
        <div style="display:flex; align-items:center;">
        <span style="font-size:1.18em; color:#ffaf19; margin-right:8px;">&#128161;</span>
        <span style="font-weight:600;">${escapeHTML(blog.title)}</span>, ${escapeHTML(blog.author)}, ${escapeHTML(blog.date)}
        <button class="info-btn" aria-label="Show blog content"
            style="margin-left:18px; background:none; border:none; font-size:1.23em; cursor:pointer; color:#4981a1;">&#9654;</button>
        </div>
        <div class="profile-detail" style="display:none; margin-top:10px; font-size:0.98rem; color:#212; background:#f7fafb; border-radius:8px; padding:16px 13px 12px 13px; text-align:left;">
        <p>${escapeHTML(blog.para1)}</p>
        ${blog.img1 ? `<img src="${escapeHTML(blog.img1)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
        <p>${escapeHTML(blog.para2)}</p>
        ${blog.img2 ? `<img src="${escapeHTML(blog.img2)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
        </div>
    </li>
            `.trim();
    });
    html += '\n</ul>';
    const exportArea = document.getElementById('export-area');
    exportArea.value = html;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    function exportFullHTML() {
    let fragment = '';
    blogs.forEach(blog => {
        fragment += `
    <li style="margin-bottom:11px;">
        <div style="display:flex; align-items:center;">
        <span style="font-size:1.18em; color:#ffaf19; margin-right:8px;">&#128161;</span>
        <span style="font-weight:600;">${escapeHTML(blog.title)}</span>, ${escapeHTML(blog.author)}, ${escapeHTML(blog.date)}
        <button class="info-btn" aria-label="Show blog content"
            style="margin-left:18px; background:none; border:none; font-size:1.23em; cursor:pointer; color:#4981a1;">&#9654;</button>
        </div>
        <div class="profile-detail" style="display:none; margin-top:10px; font-size:0.98rem; color:#212; background:#f7fafb; border-radius:8px; padding:16px 13px 12px 13px; text-align:left;">
        <p>${escapeHTML(blog.para1)}</p>
        ${blog.img1 ? `<img src="${escapeHTML(blog.img1)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
        <p>${escapeHTML(blog.para2)}</p>
        ${blog.img2 ? `<img src="${escapeHTML(blog.img2)}" style="display:block;max-width:350px;margin:12px 0 6px 0;border-radius:8px;box-shadow:0 1px 6px #003a6b11;">` : ''}
        </div>
    </li>
            `.trim();
    });
    let full = fullBlogHTML;
    full = full.replace(/<ul class="blog-list"[^>]*>[\s\S]*?<\/ul>/, `<ul class="blog-list" style="margin:0 0 16px 18px; padding-left:0; list-style-type: none;">\n${fragment}\n</ul>`);
    const exportArea = document.getElementById('export-area');
    exportArea.value = full;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    // ---- TEAM EDITOR (MS/IIITB) ----
    function showTeamEditorLoad(fileName) {
    teamFileName = fileName;
    document.getElementById('main-content').innerHTML = `
        <h2 style="color:#004080;display:flex;align-items:center;gap:12px;margin-bottom:28px;">
        <span class="title-icon">&#128101;</span> Team Editor (${fileName.replace('.html','').replace('-',' ')})
        </h2>
        <button class="action-btn action-btn-secondary" onclick="fetchAndParseTeam('${fileName}', true)">Load Team Data</button>
        <div id="team-editor"></div>
    `;
    }
    async function fetchAndParseTeam(fileName, renderNow) {
    const main = document.getElementById('team-editor') || document.getElementById('main-content');
    main.innerHTML = `<div id="loading">Loading team from ${fileName}...</div>`;
    teamFileName = fileName;
    try {
        const res = await fetch(fileName);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const html = await res.text();
        _fullTeamHTML = html;
        const doc = new DOMParser().parseFromString(html, "text/html");
        const grid = doc.querySelector(".team-grid");
        if (!grid) throw new Error("Team grid not found in " + fileName);
        teamMembers = [];
    for (const card of grid.querySelectorAll(".member")) {
    // IMAGE
    const img = card.querySelector('img');
    // NAME + LINK
    const a = card.querySelector('a');
    let name = "", link = "#";
    if (a) {
        name = a.textContent.trim();
        link = a.getAttribute('href') || "#";
    }
    // TITLE (the next div after <a>)
    let title = "";
    if (a && a.parentElement) {
        const siblings = Array.from(a.parentElement.children);
        const idx = siblings.indexOf(a);
        if (idx !== -1 && siblings.length > idx + 1) {
        title = siblings[idx + 1].textContent.trim();
        }
    }
    // PROFILE
    const profileDiv = card.querySelector('.profile-detail');
    const profile = profileDiv ? profileDiv.textContent.trim() : "";

    teamMembers.push({
        img: img ? img.getAttribute('src') : "",
        name,
        link,
        title,
        profile
    });
    }
        if (renderNow) showTeamEditor();
    } catch (err) {
        main.innerHTML = `<div id="error">Error: ${err.message}</div>`;
    }
    }
    function showTeamEditor() {
    teamMembers.sort((a, b) => a.name.localeCompare(b.name));
    let html = `<div class="action-btn-row">
        <button class="action-btn action-btn-primary" onclick="addTeamMember()">+ Add New Member</button>
        <button class="action-btn action-btn-secondary" onclick="exportTeamHTML()">Generate file fragment - ${teamFileName}</button>
        <button class="action-btn action-btn-success" onclick="exportFullTeamHTML()">Generate full file - ${teamFileName}</button>
    </div>
    <textarea id="export-team-area" style="margin-top:18px;display:none;width:100%;" rows="10"></textarea>
    <div id="team-editor-list"></div>`;
    document.getElementById('team-editor').innerHTML = html;
    renderTeamEditor();
    }
    function renderTeamEditor() {
    const container = document.getElementById('team-editor-list');
    if (!container) return;
    container.innerHTML = '';
    teamMembers.forEach((member, idx) => {
        const memberBlock = document.createElement('div');
        memberBlock.className = 'blog-edit-block';
        memberBlock.innerHTML = `
        <div class="blog-icon-cell">
            <span class="title-icon">&#128100;</span>
        </div>
        <div class="blog-fields-cell">
            <div class="image-insert-row">
            <label>Image (path &amp; file name):</label>
            <input type="text" placeholder="./Images/ms-team/xyz.png" value="${escapeHTML(member.img)}" onchange="updateTeamMember(${idx}, 'img', this.value)" />
            ${member.img ? `<img src="${escapeHTML(member.img)}" class="image-preview" onerror="this.style.display='none'">` : ''}
            </div>
            <label>Name:
            <input type="text" value="${escapeHTML(member.name)}" onchange="updateTeamMember(${idx}, 'name', this.value)" />
            </label>
            <label>Name Hyperlink:
            <input type="text" value="${escapeHTML(member.link || "#")}" onchange="updateTeamMember(${idx}, 'link', this.value)" />
            </label>
            <label>Title:
            <input type="text" value="${escapeHTML(member.title)}" onchange="updateTeamMember(${idx}, 'title', this.value)" />
            </label>
            <label>Profile:
            <textarea onchange="updateTeamMember(${idx}, 'profile', this.value)">${escapeHTML(member.profile)}</textarea>
            </label>
            <div class="actions">
            <button onclick="deleteTeamMember(${idx})">Delete</button>
            </div>
        </div>
        `;
        container.appendChild(memberBlock);
    });
    }
    function updateTeamMember(idx, field, value) { teamMembers[idx][field] = value; }
    function deleteTeamMember(idx) {
    if (confirm('Are you sure you want to delete this member?')) {
        teamMembers.splice(idx, 1); renderTeamEditor();
    }
    }
    function addTeamMember() {
    teamMembers.push({ img: '', name: '', link: '#', title: '', profile: '' });
    renderTeamEditor();
    }
    function exportTeamHTML() {
    teamMembers.sort((a, b) => a.name.localeCompare(b.name));
    let html = `<div class="team-grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:28px;">\n`;
    teamMembers.forEach(member => {
        html += `
    <div class="member">
        <div class="member-photo">
        <img src="${escapeHTML(member.img)}" alt="${escapeHTML(member.name)}">
        </div>
        <div class="member-info">
        <div class="member-name"><a href="${escapeHTML(member.link || "#")}" target="_blank" rel="noopener">${escapeHTML(member.name)}</a></div>
        <div class="member-title">${escapeHTML(member.title)}</div>
        <div class="member-profile">${escapeHTML(member.profile)}</div>
        </div>
    </div>
        `.trim();
    });
    html += '\n</div>';
    const exportArea = document.getElementById('export-team-area');
    exportArea.value = html;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    function exportFullTeamHTML() {
    teamMembers.sort((a, b) => a.name.localeCompare(b.name));
    let fragment = `<div class="team-grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:28px;">\n`;
    teamMembers.forEach(member => {
    html += `
    <div class="member" style="border:1.5px solid #d4d7dc; padding:18px 14px 22px 14px; border-radius:12px; position:relative; box-shadow:0 4px 16px 0 rgba(50,50,70,0.06); background:#fff;">
        <div style="position:relative; width:120px; height:120px; margin:0 auto 16px auto;">
        <img src="${escapeHTML(member.img)}" alt="${escapeHTML(member.name)}"
            style="width:120px; height:120px; object-fit:cover; border-radius:8px; display:block; box-shadow:0 2px 8px rgba(0,0,0,0.07);" />
        <button class="info-btn" aria-label="Show profile"
                style="position:absolute; top:7px; right:7px; background:none; border:none; font-size:1.38em; cursor:pointer; z-index:2; color:#4981a1;">ℹ️</button>
        </div>
        <div style="text-align:center;">
        <a href="${escapeHTML(member.link || "#")}" style="font-weight:700; color:#194186; text-decoration:none; font-size:1.15rem; display:inline-block; margin-bottom:2px;" target="_blank" rel="noopener">${escapeHTML(member.name)}</a>
        <div style="font-size:0.98rem; color:#555; margin-bottom:8px;">${escapeHTML(member.title)}</div>
        </div>
        <div class="profile-detail" style="display:none; margin-top:10px; font-size:0.98rem; color:#212; background:#f7fafb; border-radius:8px; padding:16px 13px 12px 13px; text-align:left;">
        ${escapeHTML(member.profile)}
        </div>
    </div>
    `.trim();
    });
    fragment += '\n</div>';
    let full = _fullTeamHTML;
    full = full.replace(/<div class="team-grid"[^>]*>[\s\S]*?<\/div>/, fragment);
    const exportArea = document.getElementById('export-team-area');
    exportArea.value = full;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    // ---- EVENTS & NEWS EDITOR ----
    function showEventsNewsEditorLoad() {
    document.getElementById('main-content').innerHTML = `
        <h2 style="color:#004080;display:flex;align-items:center;gap:12px;margin-bottom:28px;">
        <span class="title-icon">&#128197;</span> Events & News Editor
        </h2>
        <button class="action-btn action-btn-secondary" onclick="fetchAndParseEventsNews(true)">Load Events & News</button>
        <div id="events-news-editor"></div>
    `;
    }
    async function fetchAndParseEventsNews(renderNow) {
    const main = document.getElementById('events-news-editor') || document.getElementById('main-content');
    main.innerHTML = `<div id="loading">Loading news-events.html...</div>`;
    try {
        const res = await fetch(eventsNewsFile);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const html = await res.text();
        _fullEventsNewsHTML = html;
        const doc = new DOMParser().parseFromString(html, "text/html");
        // EVENTS
        const eventsH2 = Array.from(doc.querySelectorAll('h2')).find(h2 => h2.textContent.includes('Events'));
        const eventsUl = eventsH2 && eventsH2.nextElementSibling && eventsH2.nextElementSibling.tagName === "UL" ? eventsH2.nextElementSibling : null;
        eventsList = [];
        if (eventsUl) {
        for (const li of eventsUl.querySelectorAll('li')) {
            const a = li.querySelector('a');
            if (!a) continue;
            let name = a.textContent.trim();
            let date = '';
            let m = name.match(/(.+?)\s+on\s+([\d-]{6,})$/i);
            if (m) {
            name = m[1].trim();
            date = m[2].trim();
            }
            eventsList.push({
            name,
            date,
            link: a.getAttribute('href') || ''
            });
        }
        }
        // NEWS
        const newsH2 = Array.from(doc.querySelectorAll('h2')).find(h2 => h2.textContent.includes('News'));
        const newsUl = newsH2 && newsH2.nextElementSibling && newsH2.nextElementSibling.tagName === "UL" ? newsH2.nextElementSibling : null;
        newsList = [];
        if (newsUl) {
        for (const li of newsUl.querySelectorAll('li')) {
            const a = li.querySelector('a');
            if (!a) continue;
            let name = a.textContent.trim();
            let href = a.getAttribute('href') || '';
            let pdf = '', ext = '';
            if (href.endsWith('.pdf')) pdf = href;
            else ext = href;
            newsList.push({
            name,
            pdf,
            ext
            });
        }
        }
        if (renderNow) showEventsNewsEditor();
    } catch (err) {
        main.innerHTML = `<div id="error">Error: ${err.message}</div>`;
    }
    }
    function showEventsNewsEditor() {
    let html = `<div class="action-btn-row">
        <button class="action-btn action-btn-primary" onclick="addEvent()">+ Add Event</button>
        <button class="action-btn action-btn-primary" onclick="addNews()">+ Add News</button>
        <button class="action-btn action-btn-secondary" onclick="exportEventsNewsHTML()">Generate file fragment - news-events.html</button>
        <button class="action-btn action-btn-success" onclick="exportFullEventsNewsHTML()">Generate full file - news-events.html</button>
    </div>
    <textarea id="export-events-area" style="margin-top:18px;display:none;width:100%;" rows="10"></textarea>
    <div id="events-editor"></div>
    <div id="news-editor"></div>
    `;
    document.getElementById('events-news-editor').innerHTML = html;
    renderEventsEditor();
    renderNewsEditor();
    }
    function renderEventsEditor() {
    const container = document.getElementById('events-editor');
    if (!container) return;
    let html = `<h3 style="color:#0a4;">Events</h3>`;
    eventsList.forEach((event, idx) => {
        html += `
        <div class="blog-edit-block">
        <div class="blog-icon-cell">
            <span class="title-icon">&#127919;</span>
        </div>
        <div class="blog-fields-cell">
            <label>Event Name:
            <input type="text" value="${escapeHTML(event.name)}" onchange="updateEvent(${idx}, 'name', this.value)" />
            </label>
            <label>Date:
            <input type="text" value="${escapeHTML(event.date)}" onchange="updateEvent(${idx}, 'date', this.value)" />
            </label>
            <label>Event Link (local HTML or hash):
            <input type="text" value="${escapeHTML(event.link)}" onchange="updateEvent(${idx}, 'link', this.value)" />
            </label>
            <div class="actions">
            <button onclick="deleteEvent(${idx})">Delete</button>
            </div>
        </div>
        </div>`;
    });
    container.innerHTML = html;
    }
    function updateEvent(idx, field, value) { eventsList[idx][field] = value; }
    function deleteEvent(idx) {
    if (confirm('Delete this event?')) {
        eventsList.splice(idx, 1); renderEventsEditor();
    }
    }
    function addEvent() { eventsList.push({ name: '', date: '', link: '' }); renderEventsEditor(); }
    // NEWS
    function renderNewsEditor() {
    const container = document.getElementById('news-editor');
    if (!container) return;
    let html = `<h3 style="color:#4176bc;">News</h3>`;
    newsList.forEach((news, idx) => {
        html += `
        <div class="blog-edit-block">
        <div class="blog-icon-cell">
            <span class="title-icon">&#128240;</span>
        </div>
        <div class="blog-fields-cell">
            <label>News Item Name:
            <input type="text" value="${escapeHTML(news.name)}" onchange="updateNews(${idx}, 'name', this.value)" />
            </label>
            <label>PDF File Link (optional):
            <input type="text" value="${escapeHTML(news.pdf)}" onchange="updateNews(${idx}, 'pdf', this.value)" />
            </label>
            <label>External Hyperlink (optional):
            <input type="text" value="${escapeHTML(news.ext)}" onchange="updateNews(${idx}, 'ext', this.value)" />
            </label>
            <div class="actions">
            <button onclick="deleteNews(${idx})">Delete</button>
            </div>
        </div>
        </div>`;
    });
    container.innerHTML = html;
    }
    function updateNews(idx, field, value) { newsList[idx][field] = value; }
    function deleteNews(idx) {
    if (confirm('Delete this news item?')) {
        newsList.splice(idx, 1); renderNewsEditor();
    }
    }
    function addNews() { newsList.push({ name: '', pdf: '', ext: '' }); renderNewsEditor(); }
    // --- EXPORTS ---
    function exportEventsNewsHTML() {
    let html = `<section class="news-events-section" style="max-width: 800px; margin: 40px auto; line-height: 1.6; font-family: 'Inter', Arial, sans-serif; text-align: left;">
    <h2 style="margin:0 0 20px 0; color:#002244; display:flex; align-items:center; font-size:2rem; font-weight:700; gap:0.6em; letter-spacing:-0.5px;">
        <span style="font-size:1.2em;">&#128197;</span> Events
    </h2>
    <ul style="list-style:none; padding:0 0 0 22px; margin:0 0 36px 0;">\n`;
    eventsList.forEach(event => {
        let eventLabel = escapeHTML(event.name);
        if (event.date) eventLabel += ` on ${escapeHTML(event.date)}`;
        html += `
        <li style="margin-bottom:22px; display:flex; align-items:flex-start; line-height:1.8;">
        <span style="margin-right:0.9em; margin-top:3px; font-size:1.3em; color:#ff6600;">&#127919;</span>
        <a 
            href="${escapeHTML(event.link)}"
            class="nav-link"
            data-parent="News & Events"
            style="font-size:1.18rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.7; box-shadow:0 0 0 rgba(0,0,0,0);"
        >${eventLabel}</a>
        </li>`;
    });
    html += `
    </ul>
    <hr style="border:0; border-top:2px solid #c3c3c3; margin:34px 0 42px 0;">
    <h2 style="margin:0 0 20px 0; color:#002244; display:flex; align-items:center; font-size:2rem; font-weight:700; gap:0.6em; letter-spacing:-0.5px;">
        <span style="font-size:1.2em;">&#128240;</span> News
    </h2>
    <ul style="list-style:none; padding:0 0 0 22px; margin:0 0 12px 0;">\n`;
    newsList.forEach(news => {
        let link = news.pdf ? news.pdf : news.ext;
        if (!link) link = "#";
        html += `
        <li style="margin-bottom:22px; display:flex; align-items:flex-start; line-height:1.8;">
        <span style="margin-right:0.9em; margin-top:3px; font-size:1.3em; color:#4176bc;">&#128240;</span>
        <a 
            href="${escapeHTML(link)}"
            target="_blank"
            rel="noopener noreferrer"
            style="font-size:1.14rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.7; box-shadow:0 0 0 rgba(0,0,0,0);"
        >${escapeHTML(news.name)}</a>
        </li>`;
    });
    html += `
    </ul>
    </section>`;
    const exportArea = document.getElementById('export-events-area');
    exportArea.value = html;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    function exportFullEventsNewsHTML() {
    let fragment = `<section class="news-events-section" style="max-width: 800px; margin: 40px auto; line-height: 1.6; font-family: 'Inter', Arial, sans-serif; text-align: left;">
    <h2 style="margin:0 0 20px 0; color:#002244; display:flex; align-items:center; font-size:2rem; font-weight:700; gap:0.6em; letter-spacing:-0.5px;">
        <span style="font-size:1.2em;">&#128197;</span> Events
    </h2>
    <ul style="list-style:none; padding:0 0 0 22px; margin:0 0 36px 0;">\n`;
    eventsList.forEach(event => {
        let eventLabel = escapeHTML(event.name);
        if (event.date) eventLabel += ` on ${escapeHTML(event.date)}`;
        fragment += `
        <li style="margin-bottom:22px; display:flex; align-items:flex-start; line-height:1.8;">
        <span style="margin-right:0.9em; margin-top:3px; font-size:1.3em; color:#ff6600;">&#127919;</span>
        <a 
            href="${escapeHTML(event.link)}"
            class="nav-link"
            data-parent="News & Events"
            style="font-size:1.18rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.7; box-shadow:0 0 0 rgba(0,0,0,0);"
        >${eventLabel}</a>
        </li>`;
    });
    fragment += `
    </ul>
    <hr style="border:0; border-top:2px solid #c3c3c3; margin:34px 0 42px 0;">
    <h2 style="margin:0 0 20px 0; color:#002244; display:flex; align-items:center; font-size:2rem; font-weight:700; gap:0.6em; letter-spacing:-0.5px;">
        <span style="font-size:1.2em;">&#128240;</span> News
    </h2>
    <ul style="list-style:none; padding:0 0 0 22px; margin:0 0 12px 0;">\n`;
    newsList.forEach(news => {
        let link = news.pdf ? news.pdf : news.ext;
        if (!link) link = "#";
        fragment += `
        <li style="margin-bottom:22px; display:flex; align-items:flex-start; line-height:1.8;">
        <span style="margin-right:0.9em; margin-top:3px; font-size:1.3em; color:#4176bc;">&#128240;</span>
        <a 
            href="${escapeHTML(link)}"
            target="_blank"
            rel="noopener noreferrer"
            style="font-size:1.14rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.7; box-shadow:0 0 0 rgba(0,0,0,0);"
        >${escapeHTML(news.name)}</a>
        </li>`;
    });
    fragment += `
    </ul>
    </section>`;
    let full = _fullEventsNewsHTML;
    full = full.replace(/<section class="news-events-section"[^>]*>[\s\S]*?<\/section>/, fragment);
    const exportArea = document.getElementById('export-events-area');
    exportArea.value = full;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    // ---- RESEARCH EDITOR ----
    function showResearchEditorLoad() {
    document.getElementById('main-content').innerHTML = `
        <h2 style="color:#004080;display:flex;align-items:center;gap:12px;margin-bottom:28px;">
        <span class="title-icon">&#128218;</span> Research Editor
        </h2>
        <button class="action-btn action-btn-secondary" onclick="fetchAndParseResearch(true)">Load Research</button>
        <div id="research-editor"></div>
    `;
    }
    async function fetchAndParseResearch(renderNow) {
    const main = document.getElementById('research-editor') || document.getElementById('main-content');
    main.innerHTML = `<div id="loading">Loading research.html...</div>`;
    try {
        const res = await fetch(researchFile);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const html = await res.text();
        _fullResearchHTML = html;
        const doc = new DOMParser().parseFromString(html, "text/html");

        // Publications
        // --- Find the right <ul> for Publications, even if not immediately after <h2> ---
        let pubsUl = null;
        const pubsH2 = Array.from(doc.querySelectorAll('h2')).find(h2 => h2.textContent.toLowerCase().includes('publications'));
        if (pubsH2) {
        // Find the first <ul> after this <h2>, skipping other elements
        let el = pubsH2.nextElementSibling;
        while (el && el.tagName !== "UL") el = el.nextElementSibling;
        if (el && el.tagName === "UL") pubsUl = el;
        }
        publicationsList = [];
        if (pubsUl) {
        for (const li of pubsUl.querySelectorAll('li')) {
            const a = li.querySelector('a');
            if (!a) continue;
            let name = a.textContent.trim();
            let date = "";
            // Match title and date in the form "Some Paper Title: Dated Sep 2024"
            let m = name.match(/^(.+):\s*Dated\s*(.+)$/i);
            if (m) {
            name = m[1].trim();
            date = m[2].trim();
            }
            publicationsList.push({
            name,
            link: a.getAttribute('href') || "",
            date
            });
        }
        }

        // Reports
        let reportsUl = null;
        const reportsH2 = Array.from(doc.querySelectorAll('h2')).find(h2 => h2.textContent.toLowerCase().includes('report'));
        if (reportsH2) {
        let el = reportsH2.nextElementSibling;
        while (el && el.tagName !== "UL") el = el.nextElementSibling;
        if (el && el.tagName === "UL") reportsUl = el;
        }
        reportsList = [];
        if (reportsUl) {
        for (const li of reportsUl.querySelectorAll('li')) {
            const a = li.querySelector('a');
            if (!a) continue;
            let name = a.textContent.trim();
            let date = "";
            // Match title and date in the form "Report-1 dated 25-April-2025"
            let m = name.match(/^(.+)\s+dated\s+(.+)$/i);
            if (m) {
            name = m[1].trim();
            date = m[2].trim();
            }
            reportsList.push({
            name,
            date,
            link: a.getAttribute('href') || ""
            });
        }
        }

        if (renderNow) showResearchEditor();
    } catch (err) {
        main.innerHTML = `<div id="error">Error: ${err.message}</div>`;
    }
    }

    function showResearchEditor() {
    let html = `<div class="action-btn-row">
        <button class="action-btn action-btn-primary" onclick="addPublication()">+ Add Publication</button>
        <button class="action-btn action-btn-primary" onclick="addReport()">+ Add Report</button>
        <button class="action-btn action-btn-secondary" onclick="exportResearchHTML()">Generate file fragment - research.html</button>
        <button class="action-btn action-btn-success" onclick="exportFullResearchHTML()">Generate full file - research.html</button>
    </div>
    <textarea id="export-research-area" style="margin-top:18px;display:none;width:100%;" rows="10"></textarea>
    <div id="pubs-editor"></div>
    <div id="reports-editor"></div>
    `;
    document.getElementById('research-editor').innerHTML = html;
    renderPubsEditor();
    renderReportsEditor();
    }

    // PUBLICATIONS
    function renderPubsEditor() {
    const container = document.getElementById('pubs-editor');
    if (!container) return;
    let html = `<h3 style="color:#348feb;">Publications</h3>`;
    publicationsList.forEach((pub, idx) => {
        html += `
        <div class="blog-edit-block">
        <div class="blog-icon-cell">
            <span class="title-icon">&#128214;</span>
        </div>
        <div class="blog-fields-cell">
            <label>Name:
            <input type="text" value="${escapeHTML(pub.name)}" onchange="updatePublication(${idx}, 'name', this.value)" />
            </label>
            <label>External Hyperlink:
            <input type="text" value="${escapeHTML(pub.link)}" onchange="updatePublication(${idx}, 'link', this.value)" />
            </label>
            <label>Date:
            <input type="text" value="${escapeHTML(pub.date)}" onchange="updatePublication(${idx}, 'date', this.value)" />
            </label>
            <div class="actions">
            <button onclick="deletePublication(${idx})">Delete</button>
            </div>
        </div>
        </div>`;
    });
    container.innerHTML = html;
    }
    function updatePublication(idx, field, value) { publicationsList[idx][field] = value; }
    function deletePublication(idx) {
    if (confirm('Delete this publication?')) {
        publicationsList.splice(idx, 1); renderPubsEditor();
    }
    }
    function addPublication() {
    publicationsList.push({ name: '', link: '', date: '' });
    renderPubsEditor();
    }

    // REPORTS
    function renderReportsEditor() {
    const container = document.getElementById('reports-editor');
    if (!container) return;
    let html = `<h3 style="color:#e7a713;">Study Reports</h3>`;
    reportsList.forEach((report, idx) => {
        html += `
        <div class="blog-edit-block">
        <div class="blog-icon-cell">
            <span class="title-icon">&#128221;</span>
        </div>
        <div class="blog-fields-cell">
            <label>Name:
            <input type="text" value="${escapeHTML(report.name)}" onchange="updateReport(${idx}, 'name', this.value)" />
            </label>
            <label>Date:
            <input type="text" value="${escapeHTML(report.date)}" onchange="updateReport(${idx}, 'date', this.value)" />
            </label>
            <label>PDF Link:
            <input type="text" value="${escapeHTML(report.link)}" onchange="updateReport(${idx}, 'link', this.value)" />
            </label>
            <div class="actions">
            <button onclick="deleteReport(${idx})">Delete</button>
            </div>
        </div>
        </div>`;
    });
    container.innerHTML = html;
    }
    function updateReport(idx, field, value) { reportsList[idx][field] = value; }
    function deleteReport(idx) {
    if (confirm('Delete this report?')) {
        reportsList.splice(idx, 1); renderReportsEditor();
    }
    }
    function addReport() {
    reportsList.push({ name: '', date: '', link: '' });
    renderReportsEditor();
    }

    // --- EXPORTS ---
    function exportResearchHTML() {
    let html = `<section style="max-width: 800px; margin: 40px auto; padding: 32px 22px 40px 22px; background: #fff; border-radius: 12px; box-shadow: 0 2px 18px rgba(0,32,128,0.04); font-family: 'Inter', Arial, sans-serif; text-align: left;">
    <h2 style="margin: 0 0 22px 0; color: #002244; display: flex; align-items: center; font-size: 2rem; font-weight: 700; gap: 0.6em; letter-spacing: -0.5px;">
        <span style="font-size:1.25em; color:#269;">&#128218;</span> Publications
    </h2>
    <p style="margin: 0 0 18px 24px; font-size:1rem; color:#333;">
        These are the research publications by the A4I Partners
    </p>
    <ul style="list-style: none; margin: 0 0 36px 16px; padding: 0;">\n`;
    publicationsList.forEach(pub => {
        let pubLabel = escapeHTML(pub.name);
        if (pub.date) pubLabel += `: Dated ${escapeHTML(pub.date)}`;
        html += `
        <li style="margin-bottom: 22px; display: flex; align-items: flex-start; line-height: 1.7;">
        <span style="margin-right: 0.9em; margin-top: 2px; font-size: 1.18em; color: #348feb;">&#128214;</span>
        <a
            href="${escapeHTML(pub.link)}"
            class="nav-link"
            data-parent="Research"
            data-section="Publications"
            style="font-size:1.14rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.5; box-shadow:0 0 0 rgba(0,0,0,0);"
            target="_blank" rel="noopener noreferrer"
        >${pubLabel}</a>
        </li>`;
    });
    html += `
    </ul>
    <hr style="border:0; border-top:2px solid #c3c3c3; margin: 28px 0 32px 0;">
    <h2 style="margin: 0 0 22px 0; color: #002244; display: flex; align-items: center; font-size: 2rem; font-weight: 700; gap: 0.6em; letter-spacing: -0.5px;">
        <span style="font-size:1.18em; color:#e7a713;">&#128196;</span> Study Reports
    </h2>
    <p style="margin: 0 0 18px 24px; font-size:1rem; color:#333;">
        These are the reports prepared by the A4I Researchers
    </p>
    <ul style="list-style: none; margin: 0 0 10px 16px; padding: 0;">\n`;
    reportsList.forEach(report => {
        let reportLabel = escapeHTML(report.name);
        if (report.date) reportLabel += ` dated ${escapeHTML(report.date)}`;
        html += `
        <li style="margin-bottom: 20px; display: flex; align-items: flex-start; line-height: 1.7;">
        <span style="margin-right: 0.9em; margin-top: 2px; font-size: 1.13em; color: #dd5400;">&#128221;</span>
        <a href="${escapeHTML(report.link)}"
            class="nav-link"
            data-parent="Research"
            data-section="Reports"
            style="font-size:1.14rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.5; box-shadow:0 0 0 rgba(0,0,0,0);"
            target="_blank" rel="noopener noreferrer"
        >${reportLabel}</a>
        </li>`;
    });
    html += `
    </ul>
    </section>`;
    const exportArea = document.getElementById('export-research-area');
    exportArea.value = html;
    exportArea.style.display = 'block';
    exportArea.select();
    }
    function exportFullResearchHTML() {
    let fragment = `<section style="max-width: 800px; margin: 40px auto; padding: 32px 22px 40px 22px; background: #fff; border-radius: 12px; box-shadow: 0 2px 18px rgba(0,32,128,0.04); font-family: 'Inter', Arial, sans-serif; text-align: left;">
    <h2 style="margin: 0 0 22px 0; color: #002244; display: flex; align-items: center; font-size: 2rem; font-weight: 700; gap: 0.6em; letter-spacing: -0.5px;">
        <span style="font-size:1.25em; color:#269;">&#128218;</span> Publications
    </h2>
    <p style="margin: 0 0 18px 24px; font-size:1rem; color:#333;">
        These are the research publications by the A4I Partners
    </p>
    <ul style="list-style: none; margin: 0 0 36px 16px; padding: 0;">\n`;
    publicationsList.forEach(pub => {
        let pubLabel = escapeHTML(pub.name);
        if (pub.date) pubLabel += `: Dated ${escapeHTML(pub.date)}`;
        fragment += `
        <li style="margin-bottom: 22px; display: flex; align-items: flex-start; line-height: 1.7;">
        <span style="margin-right: 0.9em; margin-top: 2px; font-size: 1.18em; color: #348feb;">&#128214;</span>
        <a
            href="${escapeHTML(pub.link)}"
            class="nav-link"
            data-parent="Research"
            data-section="Publications"
            style="font-size:1.14rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.5; box-shadow:0 0 0 rgba(0,0,0,0);"
            target="_blank" rel="noopener noreferrer"
        >${pubLabel}</a>
        </li>`;
    });
    fragment += `
    </ul>
    <hr style="border:0; border-top:2px solid #c3c3c3; margin: 28px 0 32px 0;">
    <h2 style="margin: 0 0 22px 0; color: #002244; display: flex; align-items: center; font-size: 2rem; font-weight: 700; gap: 0.6em; letter-spacing: -0.5px;">
        <span style="font-size:1.18em; color:#e7a713;">&#128196;</span> Study Reports
    </h2>
    <p style="margin: 0 0 18px 24px; font-size:1rem; color:#333;">
        These are the reports prepared by the A4I Researchers
    </p>
    <ul style="list-style: none; margin: 0 0 10px 16px; padding: 0;">\n`;
    reportsList.forEach(report => {
        let reportLabel = escapeHTML(report.name);
        if (report.date) reportLabel += ` dated ${escapeHTML(report.date)}`;
        fragment += `
        <li style="margin-bottom: 20px; display: flex; align-items: flex-start; line-height: 1.7;">
        <span style="margin-right: 0.9em; margin-top: 2px; font-size: 1.13em; color: #dd5400;">&#128221;</span>
        <a href="${escapeHTML(report.link)}"
            class="nav-link"
            data-parent="Research"
            data-section="Reports"
            style="font-size:1.14rem; font-weight:600; color:#004080; text-decoration:none; background:#f7fbff; border-radius:5px; padding:11px 18px 11px 14px; transition:background .18s, color .18s, box-shadow .18s; display:inline-block; line-height:1.5; box-shadow:0 0 0 rgba(0,0,0,0);"
            target="_blank" rel="noopener noreferrer"
        >${reportLabel}</a>
        </li>`;
    });
    fragment += `
    </ul>
    </section>`;
    let full = _fullResearchHTML;
    full = full.replace(/<section[\s\S]*?<\/section>/, fragment);
    const exportArea = document.getElementById('export-research-area');
    exportArea.value = full;
    exportArea.style.display = 'block';
    exportArea.select();
    }

// Initial page load
window.onload = function() { showWelcome(); }

  </script>
</body>
</html>
